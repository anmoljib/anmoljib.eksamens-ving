<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IT Portfolio - Eksamens√∏ving</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <!-- Loading bar -->
    <div class="progress-bar-container">
      <div class="progress-bar-fill" id="progressBar"></div>
    </div>

    <!-- Toppmeny-->
    <nav class="navbar navbar-expand-md navbar-dark bg-black">
      <div class="container">
        <a class="navbar-brand" href="#">Anmol - 2IM</a>
        <div class="d-flex align-items-center gap-2">

        </div>
      </div>
    </nav>
<!-- Header-->
    <div class="container text-center">
      <div class="row">
        <div class="col">
          <h1 class="main-title"><strong> üíª Utvikling, Driftst√∏tte og Brukerst√∏tte</h1><strong></strong>
        </div>
      </div>
    </div>

    <!-- Login Box -->
    <div class="login-container">
      <div class="login-box">
        <!-- Tabs for Login/Register -->
        <div class="tabs mb-4">
          <button class="tab-btn active" onclick="switchTab('login')">Logg Inn</button>
          <button class="tab-btn" onclick="switchTab('register')">Lag Konto</button>
        </div>

        <!-- Login Form -->
        <div id="loginTab" class="tab-content active">
          <form id="loginForm">
            <div class="mb-3">
              <label for="loginUsername" class="form-label">E-post</label>
              <input type="email" class="form-control" id="loginUsername" placeholder="Skriv inn e-post">
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Passord</label>
              <div class="password-input-group">
                <input type="password" class="form-control" id="loginPassword" placeholder="Skriv inn passord">
                <button type="button" class="btn-toggle-password" onclick="togglePasswordVisibility('loginPassword', 'loginToggleIcon')">
                  <span id="loginToggleIcon">üëÅÔ∏è</span>
                </button>
              </div>
            </div>
            <div id="loginError" class="text-danger mb-3" style="display:none;"></div>
            <button type="submit" class="btn btn-primary w-100">Logg Inn</button>
          </form>
        </div>

        <!-- Register Form -->
        <div id="registerTab" class="tab-content" style="display:none;">
          <form id="registerForm">
            <div class="mb-3">
              <label for="registerUsername" class="form-label">E-post</label>
              <input type="email" class="form-control" id="registerUsername" placeholder="Skriv inn e-post">
            </div>
            <div class="mb-3">
              <label for="registerPassword" class="form-label">Passord</label>
              <div class="password-input-group">
                <input type="password" class="form-control" id="registerPassword" placeholder="Skriv inn passord">
                <button type="button" class="btn-toggle-password" onclick="togglePasswordVisibility('registerPassword', 'registerToggleIcon')">
                  <span id="registerToggleIcon">üëÅÔ∏è</span>
                </button>
              </div>
            </div>
            <div class="mb-3">
              <label for="registerPasswordConfirm" class="form-label">Bekreft Passord</label>
              <div class="password-input-group">
                <input type="password" class="form-control" id="registerPasswordConfirm" placeholder="Bekreft passord">
                <button type="button" class="btn-toggle-password" onclick="togglePasswordVisibility('registerPasswordConfirm', 'registerConfirmToggleIcon')">
                  <span id="registerConfirmToggleIcon">üëÅÔ∏è</span>
                </button>
              </div>
            </div>
            <div id="registerError" class="text-danger mb-3" style="display:none;"></div>
            <button type="submit" class="btn btn-primary w-100">Lag Konto</button>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
    <script>
      // Toggle password visibility
      function togglePasswordVisibility(inputId, iconId) {
        const passwordInput = document.getElementById(inputId);
        const toggleIcon = document.getElementById(iconId);
        
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleIcon.textContent = 'üôà';
        } else {
          passwordInput.type = 'password';
          toggleIcon.textContent = 'üëÅÔ∏è';
        }
      }

      // Switch between login and register tabs
      function switchTab(tab) {
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const tabs = document.querySelectorAll('.tab-btn');

        tabs.forEach(t => t.classList.remove('active'));

        if (tab === 'login') {
          loginTab.style.display = 'block';
          registerTab.style.display = 'none';
          tabs[0].classList.add('active');
        } else {
          loginTab.style.display = 'none';
          registerTab.style.display = 'block';
          tabs[1].classList.add('active');
        }
      }

      // Handle login form submission
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        const errorMessage = document.getElementById('loginError');
        await loginUser(email, password, errorMessage);
      });

      // Handle register form submission
      document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('registerUsername').value;
        const password = document.getElementById('registerPassword').value;
        const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
        const errorMessage = document.getElementById('registerError');

        if (password !== passwordConfirm) {
          errorMessage.textContent = 'Passordene matcher ikke';
          errorMessage.style.display = 'block';
          return;
        }

        await registerUser(email, password, errorMessage);
      });

      // Login function
      async function loginUser(email, password, errorMessage) {
        if (!email || !password) {
          errorMessage.textContent = 'Vennligst fyll inn b√•de e-post og passord';
          errorMessage.style.display = 'block';
          return;
        }

        try {
          const { data, error } = await supabaseClient.auth.signInWithPassword({
            email,
            password,
          });

          if (error) {
            errorMessage.textContent = 'Feil: ' + error.message;
            errorMessage.style.display = 'block';
            console.error('Login error:', error);
            return;
          }

          if (data.user) {
            console.log('Login vellykket!');
            window.location.href = 'index.html';
          }
        } catch (err) {
          errorMessage.textContent = 'En feil oppstod: ' + err.message;
          errorMessage.style.display = 'block';
          console.error('Exception:', err);
        }
      }

      // Register function
      async function registerUser(email, password, errorMessage) {
        if (!email || !password) {
          errorMessage.textContent = 'Vennligst fyll inn b√•de e-post og passord';
          errorMessage.style.display = 'block';
          return;
        }

        try {
          const { data, error } = await supabaseClient.auth.signUp({
            email,
            password,
          });

          if (error) {
            errorMessage.textContent = 'Feil: ' + error.message;
            errorMessage.style.display = 'block';
            console.error('Register error:', error);
            return;
          }

          console.log('Registrering vellykket! Bekreftelses-epost sendt til: ' + email);
          
          // Show success message - user must confirm email first
          errorMessage.style.color = 'green';
          errorMessage.textContent = 'Registrering vellykket! Sjekk e-posten din for bekreftelses-lenke. Du m√• bekrefte e-posten f√∏r du kan logge inn.';
          errorMessage.style.display = 'block';
          
          // Clear the form
          document.getElementById('registerForm').reset();
          
          // Switch back to login tab after 3 seconds
          setTimeout(() => {
            switchTab('login');
            errorMessage.style.color = '';
          }, 3000);
        } catch (err) {
          errorMessage.style.color = '';
          errorMessage.textContent = 'En feil oppstod: ' + err.message;
          errorMessage.style.display = 'block';
          console.error('Exception:', err);
        }
      }
    </script>

  </body>
  </html>